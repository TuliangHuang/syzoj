<% if (typeof existingAnswers === 'undefined' || existingAnswers == null) { existingAnswers = []; } %>
<% var onlyOne = (items && items.length === 1); %>
<% (items || []).forEach(function(it, idx){ %>
  <div class="ui basic segment" style="border: none; box-shadow: none; padding: 0; ">
    <% if(!onlyOne || it.prompt) { %>
    <div class="font-content" style="margin-bottom: 1em; display: flex; align-items: baseline; gap: 6px; flex-wrap: wrap; ">
      <% if (!onlyOne) { %><span><%= it.num %>.</span><% } %>
      <% if (it.prompt) { %>
        <div style="flex: 1 1 auto; min-width: 0; "><%- it.prompt %></div>
      <% } %>
      <% if (showAllPoints) { %>
        <span class="q-pts">（<%= it.points %>分）</span>
      <% } %>
    </div>
    <% } %>
    <% if (it.type === 'mc') { %>
      <div class="grouped fields">
        <% (it.options || []).forEach(function(opt, i){ %>
          <div class="field">
            <div class="ui radio checkbox">
              <% var val = String.fromCharCode(65 + i); %>
              <input type="radio" name="a_<%= idx %>" value="<%= val %>" <%= (existingAnswers && existingAnswers[idx] === val) ? 'checked' : '' %> >
              <label style="display: inline-flex; align-items: baseline; gap: 6px; "><span><%= val %>.</span><span style="display: inline-block; white-space: normal; "><%- opt %></span></label>
            </div>
          </div>
        <% }); %>
      </div>
    <% } else if (it.type === 'ms') { %>
      <div class="grouped fields">
        <% (it.options || []).forEach(function(opt, i){ %>
          <div class="field">
            <div class="ui checkbox">
              <% var val = String.fromCharCode(65 + i); %>
              <input type="checkbox" name="a_<%= idx %>" value="<%= val %>" <%= (existingAnswers && Array.isArray(existingAnswers[idx]) ? existingAnswers[idx] : (existingAnswers && typeof existingAnswers[idx] === 'string' ? existingAnswers[idx].split('') : [])).indexOf(val) >= 0 ? 'checked' : '' %> >
              <label style="display: inline-flex; align-items: baseline; gap: 6px; "><span><%= val %>.</span><span style="display: inline-block; white-space: normal; "><%- opt %></span></label>
            </div>
          </div>
        <% }); %>
      </div>
    <% } else if (it.type === 'tf') { %>
      <div class="grouped fields">
        <div class="field">
          <div class="ui radio checkbox">
            <input type="radio" name="a_<%= idx %>" value="T" <%= (existingAnswers && existingAnswers[idx] === 'T') ? 'checked' : '' %> >
            <label>True</label>
          </div>
        </div>
        <div class="field">
          <div class="ui radio checkbox">
            <input type="radio" name="a_<%= idx %>" value="F" <%= (existingAnswers && existingAnswers[idx] === 'F') ? 'checked' : '' %> >
            <label>False</label>
          </div>
        </div>
      </div>
    <% } else if (it.type === 'cl') { %>
      <input type="text" name="a_<%= idx %>" value="<%= existingAnswers && existingAnswers[idx] ? existingAnswers[idx] : '' %>">
    <% } else if (it.type === 'fr') { %>
      <textarea rows="5" name="a_<%= idx %>"><%= existingAnswers && existingAnswers[idx] ? existingAnswers[idx] : '' %></textarea>
    <% } %>
  </div>
<% }); %>
