<% this.title = (question && question.title ? question.title : '习题') + ' - 习题'; %>
<% include header %>

<style>
  .code-with-gutter { position: relative; }
  .code-with-gutter .code-gutter {
    position: absolute;
    left: 0;
    top: 0;
    width: 2.5em;
    color: rgba(0, 0, 0, .4);
    text-align: right;
    padding-right: .5em;
    user-select: none;
  }
  .code-with-gutter pre { padding-left: 3em; margin: 0; }
  .code-gutter .code-ln { display: block; }
  .font-content pre { margin: 0 0 1em 0; }
</style>

<div class="ui center aligned grid">
  <div class="row">
    <h1 class="ui header">
      <%= question.title || ('#' + question.id) %>
    </h1>
  </div>
  <% if (question.source) { %>
  <div class="row" style="margin-top: -15px">
    <div class="ui label">来源<div class="detail"><%= question.source %></div></div>
  </div>
  <% } %>
  <% if (question.tags && question.tags.length) { %>
  <div class="row“ style="margin-top: -15px">
    <% for (let tag of question.tags) { %>
      <a href="<%= syzoj.utils.makeUrl(['questions', 'tag', tag.id]) %>" class="ui <%= tag.color %> label"><%= tag.name %></a>
    <% } %>
  </div>
  <% } %>
</div>

<div class="ui grid">
  <% if (allowedEdit) { %>
  <div class="row">
    <div class="column">
      <div class="ui tiny buttons right floated">
        <a class="ui button" href="<%= syzoj.utils.makeUrl(['question', question.id, 'edit']) %>">编辑</a>
      </div>
    </div>
  </div>
  <% } %>
  <div class="row" style="padding-bottom: 0; ">
    <div class="column">
      <h2 class="ui header"><%= (question && question.type) ? question.type : '题目' %></h2>
      <% if (descriptionHtml) { %>
      <div class="font-content"><%- descriptionHtml %></div>
      <% } %>
    </div>
  </div>
  
  <% if (items && items.length) { %>
  <div class="row">
    <div class="column">
      <div class="ui form">
        <div class="field">
          <% include question_items %>
        </div>
      </div>
    </div>
  </div>
  <% } %>

  <% if (allowedEdit && answerHtml) { %>
  <div class="row">
    <div class="column">
      <h2 class="ui header">标准答案</h2>
      <div class="font-content"><%- answerHtml %></div>
    </div>
  </div>
  <% } %>
  <% if (allowedEdit && tutorialHtml) { %>
  <div class="row">
    <div class="column">
      <h2 class="ui header">题解</h2>
      <div class="font-content"><%- tutorialHtml %></div>
    </div>
  </div>
  <% } %>
</div>

<div class="ui center aligned grid" style="margin-top: 20px;">
  <div class="row">
    <div class="ui pagination menu">
      <% if (prevUrl) { %>
      <a class="icon item" href="<%= prevUrl %>" title="上一题" aria-label="上一题"><i class="arrow left icon"></i></a>
      <% } %>
      <% if (nextUrl) { %>
      <a class="icon item" href="<%= nextUrl %>" title="下一题" aria-label="下一题"><i class="arrow right icon"></i></a>
      <% } %>
    </div>
  </div>
</div>

<script>
$(function(){
  $('.ui.radio.checkbox').checkbox();
  $('.ui.checkbox').checkbox();
  function addLineNumbers($root){
    $root.find('pre > code').each(function(){
      var code = this;
      if (code.getAttribute('data-ln-processed') === '1') return;
      var pre = code.parentNode;
      var $pre = $(pre);
      var $wrapper = $('<div class="code-with-gutter"></div>');
      $pre.before($wrapper);
      $wrapper.append('<div class="code-gutter"></div>');
      $wrapper.append($pre);
      var linesCount = (code.textContent || '').replace(/\n$/, '').split('\n').length;
      var $gutter = $wrapper.find('.code-gutter');
      var lnHtml = '';
      for (var i = 1; i <= linesCount; i++) { lnHtml += '<span class="code-ln">'+ i +'</span>\n'; }
      $gutter.html(lnHtml);
      code.setAttribute('data-ln-processed', '1');
    });
  }
  addLineNumbers($('.font-content'));
});
</script>

<% include footer %>
