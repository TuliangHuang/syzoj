<% this.title = (question && question.title ? question.title : '习题') + ' - 习题'; %>
<% include header %>

<div class="ui center aligned grid">
  <div class="row">
    <h1 class="ui header">
      <%= question.title || ('#' + question.id) %>
    </h1>
  </div>
  <% if (question.source) { %>
  <div class="row" style="margin-top: -15px">
    <div class="ui label">来源<div class="detail"><%= question.source %></div></div>
  </div>
  <% } %>
  <% if (question.tags && question.tags.length) { %>
  <div class="row“ style="margin-top: -15px">
    <% for (let tag of question.tags) { %>
      <a href="<%= syzoj.utils.makeUrl(['questions', 'tag', tag.id]) %>" class="ui <%= tag.color %> label"><%= tag.name %></a>
    <% } %>
  </div>
  <% } %>
</div>

<div class="ui grid">
  <% if (allowedEdit) { %>
  <div class="row">
    <div class="column">
      <div class="ui tiny buttons right floated">
        <a class="ui button" href="<%= syzoj.utils.makeUrl(['question', question.id, 'edit']) %>">编辑</a>
      </div>
    </div>
  </div>
  <% } %>
  <div class="row">
    <div class="column">
      <h2 class="ui header">题目</h2>
      <div class="font-content"><%- descriptionHtml %></div>
    </div>
  </div>

  <div class="row">
    <div class="column">
      <% if (items && items.length) { %>
      <h2 class="ui header">作答</h2>
      <form class="ui form" method="post" action="<%= syzoj.utils.makeUrl(['question', question.id, 'submit']) %>">
        <div class="field">
          <% var onlyOne = (items.length === 1); %>
          <% items.forEach(function(it, idx){ %>
            <div class="ui segment basic" style="border: none; box-shadow: none; padding: 0; ">
              <% if(!onlyOne || it.prompt) { %>
              <div class="font-content" style="margin-bottom: 1em; display: flex; align-items: baseline; gap: 6px; flex-wrap: wrap; ">
                <% if (!onlyOne) { %><span><%= it.num %>.</span><% } %>
                <% if (it.prompt) { %>
                  <div style="flex: 1 1 auto; min-width: 0; "><%- it.prompt %></div>
                <% } %>
                <% if (showAllPoints) { %>
                  <span class="q-pts">（<%= it.points %>分）</span>
                <% } %>
              </div>
              <% } %>
              <% if (it.type === 'mc') { %>
                <div class="grouped fields">
                  <% (it.options || []).forEach(function(opt, i){ %>
                    <div class="field">
                      <div class="ui radio checkbox">
                        <input type="radio" name="q[<%= it.num %>]" value="<%= i %>">
                        <label style="display: inline-flex; align-items: baseline; gap: 6px; "><span><%= String.fromCharCode(65 + i) %>.</span><span style="display: inline-block; white-space: normal; "><%- opt %></span></label>
                      </div>
                    </div>
                  <% }); %>
                </div>
              <% } else if (it.type === 'ms') { %>
                <div class="grouped fields">
                  <% (it.options || []).forEach(function(opt, i){ %>
                    <div class="field">
                      <div class="ui checkbox">
                        <input type="checkbox" name="q[<%= it.num %>]" value="<%= i %>">
                        <label style="display: inline-flex; align-items: baseline; gap: 6px; "><span><%= String.fromCharCode(65 + i) %>.</span><span style="display: inline-block; white-space: normal; "><%- opt %></span></label>
                      </div>
                    </div>
                  <% }); %>
                </div>
              <% } else if (it.type === 'tf') { %>
                <div class="grouped fields">
                  <div class="field">
                    <div class="ui radio checkbox">
                      <input type="radio" name="q[<%= it.num %>]" value="T">
                      <label>True</label>
                    </div>
                  </div>
                  <div class="field">
                    <div class="ui radio checkbox">
                      <input type="radio" name="q[<%= it.num %>]" value="F">
                      <label>False</label>
                    </div>
                  </div>
                </div>
              <% } else if (it.type === 'cl') { %>
                <input type="text" name="q[<%= it.num %>]">
              <% } else if (it.type === 'fr') { %>
                <textarea name="q[<%= it.num %>]" rows="5"></textarea>
              <% } %>
            </div>
          <% }); %>
        </div>
        <div class="ui center aligned vertical segment" style="padding-bottom: 0; ">
          <button type="submit" class="ui labeled icon button"><i class="ui edit icon"></i>提交</button>
        </div>
      </form>
      <% } %>

      <% if (submitted) { %>
      <div class="ui positive message" style="margin-top: 10px; ">提交成功</div>
      <% } %>
    </div>
  </div>

  <% if (allowedEdit && answerHtml) { %>
  <div class="row">
    <div class="column">
      <h2 class="ui header">标准答案</h2>
      <div class="font-content"><%- answerHtml %></div>
    </div>
  </div>
  <% } %>
  <% if (allowedEdit && tutorialHtml) { %>
  <div class="row">
    <div class="column">
      <h2 class="ui header">题解</h2>
      <div class="font-content"><%- tutorialHtml %></div>
    </div>
  </div>
  <% } %>
</div>

<script>
$(function(){
  $('.ui.radio.checkbox').checkbox();
  $('.ui.checkbox').checkbox();
});
</script>

<% include footer %>


