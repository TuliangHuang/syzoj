<% include util %>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title><%= title %> - <%= syzoj.config.title %></title>
    <link href="<%- lib('semantic-ui/2.4.1/semantic.min.css') %>" rel="stylesheet">
    <link href="<%- selfLib('syntect-tomorrow.css') %>?20220512" rel="stylesheet">
    <link href="<%- selfLib('style.css') %>?20251126" rel="stylesheet">
    <link href="<%- lib('morris.js/0.5.1/morris.css') %>" rel="stylesheet">
    <!-- Preload local fonts to avoid external font fetching -->
    <link rel="preload" href="<%- syzoj.utils.makeUrl(['google-fonts','fonts','open-sans-v15-greek_latin_latin-ext_vietnamese_greek-ext_cyrillic-ext_cyrillic-regular.woff2']) %>" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="<%- syzoj.utils.makeUrl(['google-fonts','fonts','lato-v14-latin_latin-ext-regular.woff2']) %>" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="<%- syzoj.utils.makeUrl(['google-fonts','fonts','lato-v14-latin_latin-ext-700.woff2']) %>" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="<%- syzoj.utils.makeUrl(['google-fonts','fonts','fira-mono-v6-greek_latin_latin-ext_greek-ext_cyrillic-ext_cyrillic-regular.woff2']) %>" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="<%- syzoj.utils.makeUrl(['google-fonts','fonts','fira-mono-v6-greek_latin_latin-ext_greek-ext_cyrillic-ext_cyrillic-500.woff2']) %>" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="<%- lib('semantic-ui/2.4.1/themes/default/assets/fonts/icons.woff2') %>" as="font" type="font/woff2" crossorigin>
    <% if (useLocalLibs || !syzoj.config.google_fonts || !['like-google-fonts', 'like-local', 'built-in'].includes(syzoj.config.google_fonts.type)) { %>
      <link href="<%- syzoj.utils.makeUrl(['google-fonts', 'fira-mono.css']) %>" rel="stylesheet">
      <link href="<%- syzoj.utils.makeUrl(['google-fonts', 'lato.css']) %>" rel="stylesheet">
      <link href="<%- syzoj.utils.makeUrl(['google-fonts', 'open-sans.css']) %>" rel="stylesheet">
      <link href="<%- syzoj.utils.makeUrl(['google-fonts', 'exo-2.css']) %>" rel="stylesheet">
    <% } else if (syzoj.config.google_fonts.type === 'like-local') { %>
      <link href="<%- syzoj.config.google_fonts.url %>/google-fonts/fira-mono.css" rel="stylesheet">
      <link href="<%- syzoj.config.google_fonts.url %>/google-fonts/lato.css" rel="stylesheet">
      <link href="<%- syzoj.config.google_fonts.url %>/google-fonts/open-sans.css" rel="stylesheet">
      <link href="<%- syzoj.config.google_fonts.url %>/google-fonts/exo-2.css" rel="stylesheet">
    <% } else if (syzoj.config.google_fonts.type === 'like-google-fonts') { %>
      <link href="<%- syzoj.config.google_fonts.url %>/css?family=Fira+Mono" rel="stylesheet">
      <link href="<%- syzoj.config.google_fonts.url %>/css?family=Lato:400,700,400italic,700italic&subset=latin" rel="stylesheet">
      <link href="<%- syzoj.config.google_fonts.url %>/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i&amp;subset=latin-ext" rel="stylesheet">
      <link href="<%- syzoj.config.google_fonts.url %>/css?family=Exo+2:600" rel="stylesheet">
    <% } else if (syzoj.config.google_fonts.type === 'built-in') { %>
      <link href="<%- this.builtInCdnUrl %>/google-fonts/fira-mono.css" rel="stylesheet">
      <link href="<%- this.builtInCdnUrl %>/google-fonts/lato.css" rel="stylesheet">
      <link href="<%- this.builtInCdnUrl %>/google-fonts/open-sans.css" rel="stylesheet">
      <link href="<%- this.builtInCdnUrl %>/google-fonts/exo-2.css" rel="stylesheet">
    <% } %>
    <script data-cfasync="false" src="<%- lib('jquery/3.3.1/jquery.min.js') %>"></script>
    <% if (syzoj.config.google_analytics && syzoj.config.google_analytics !== 'UA-XXXXXXXX-X') { %>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', '<%= syzoj.config.google_analytics %>', 'auto');
      ga('send', 'pageview');

    </script>
    <% } %>
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
    <link rel="manifest" href="/favicon/site.webmanifest">
</head>
<body style="position: relative; margin-top: 49px; height: calc(100% - 49px); overflow-y: overlay; ">
    <%
      const activeKey = typeof active === 'string' ? active : '';
      const contestMatch = req.originalUrl.match(/^\/contest\/(\d+)\/.+/);
      const contestUrl = contestMatch ? `/contest/${contestMatch[1]}` : '/contests';
      const contestIcon = contestMatch ? 'calendar alternate' : 'calendar';
      const headerNavItems = [
        { isActive: activeKey === '', icon: 'home', text: '首页', href: '/' },
        { isActive: activeKey.startsWith('problem'), icon: 'list', text: '题库', href: '/problems' },
        { isActive: activeKey.startsWith('question'), icon: 'book', text: '习题', href: syzoj.utils.makeUrl(['questions']) },
        { isActive: activeKey.startsWith('contest'), icon: contestIcon, text: '比赛', href: contestUrl },
        { isActive: activeKey.startsWith('quiz'), icon: 'hourglass half', text: '小测', href: '/quizzes' },
        { isActive: activeKey.startsWith('submission'), icon: 'tasks', text: '评测', href: '/submissions' },
        { isActive: activeKey.startsWith('ranklist'), icon: 'signal', text: '排名', href: '/ranklist' },
        { isActive: activeKey.startsWith('discussion') || activeKey.startsWith('article'), icon: 'comments', text: '讨论', href: '/discussion/global' },
        { isActive: activeKey.startsWith('help'), icon: 'help circle', text: '帮助', href: '/help' }
      ];
    %>
    <div class="ui fixed borderless menu" style="position: fixed; height: 49px; ">
        <div class="ui container header-nav-container">
            <div class="header-left-items">
              <% headerNavItems.forEach(function(item) { %>
                <a class="item<% if (item.isActive) { %> active<% } %>" href="<%= item.href %>"><i class="<%= item.icon %> icon"></i> <%= item.text %></a>
              <% }); %>
            </div>
            <div class="item header-mobile-menu ui dropdown">
              <i class="bars icon"></i>
              <div class="menu">
                <% headerNavItems.forEach(function(item) { %>
                  <a class="item<% if (item.isActive) { %> active<% } %>" href="<%= item.href %>">
                    <i class="<%= item.icon %> icon"></i> <%= item.text %>
                  </a>
                <% }); %>
              </div>
            </div>
            <div class="right menu">
              <% if (user) { %>
              <a href="<%= syzoj.utils.makeUrl(['user', user.id]) %>" style="color: inherit; ">
              <div class="ui simple dropdown item">
                <%= user.username %><% if (user.nameplate) { %><%- user.nameplate %><% } %> <i class="dropdown icon"></i>
                <div class="menu">
                  <a class="item" href="<%= syzoj.utils.makeUrl(['user', user.id, 'edit']) %>"><i class="edit icon"></i>修改资料</a>
                  <% if (user.is_admin) { %>
                    <a class="item" href="<%= syzoj.utils.makeUrl(['admin', 'info']) %>"><i class="settings icon"></i>后台管理</a>
                    <div class="ui basic modal" id="modal-restart">
                      <div class="ui icon header">
                        <i class="redo icon"></i>
                        <p style="margin-top: 15px; ">重启服务</p>
                      </div>
                      <div class="content" style="text-align: center; ">
                        <p>确认重新启动 SYZOJ Web 服务吗？</p>
                      </div>
                      <div class="actions">
                        <div class="ui red basic cancel inverted button">
                          <i class="remove icon"></i>
                          否
                        </div>
                        <a class="ui green ok inverted button" href-post="<%= syzoj.utils.makeUrl(['admin', 'restart'], { url: req.query['url'] || req.originalUrl }) %>">
                          <i class="checkmark icon"></i>
                          是
                        </a>
                      </div>
                    </div>
                    <a class="item" href="#" onclick="$('#modal-restart').modal('show')"><i class="redo icon"></i>重启服务</a>
                  <% } %>
                  <a class="item" href-post="<%= syzoj.utils.makeUrl(['logout'], { url: req.originalUrl }) %>"><i class="power icon"></i>注销</a>
                </div>
              </div>
              </a>
                <% } else { %>
                <div class="item">
                    <a class="ui button" style="margin-right: 0.5em; " href="<%= syzoj.utils.makeUrl(['login'], { url: req.query['url'] || req.originalUrl }) %>">
                        登录
                    </a>
                    <a class="ui primary button" href="<%= syzoj.utils.makeUrl(['sign_up'], { url: req.query['url'] || req.originalUrl }) %>">
                        注册
                    </a>
                </div>
                <% } %>
            </div>
        </div>
    </div>
    <script>
      $(function () {
        var $mobileMenu = $('.header-mobile-menu.ui.dropdown');
        if ($mobileMenu.length) {
          $mobileMenu.dropdown({
            action: 'hide',
            on: 'click'
          });
        }
      });
    </script>
    <div style="margin-top: 87px; ">
    <div class="ui main container">
